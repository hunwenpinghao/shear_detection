# 剪刀磨损分析系统整合说明

## 📌 整合概述

已将原有的6个独立分析脚本整合到一个统一的主脚本 `main_analysis.py` 中，实现了：

1. ✅ **功能整合** - 所有分析功能统一在一个脚本中
2. ✅ **通用化** - 可以处理任意视频数据，不再硬编码路径
3. ✅ **模块化** - 支持选择性运行特定分析模块
4. ✅ **参数化** - 支持命令行参数配置各种选项
5. ✅ **批量处理** - 提供批处理脚本示例

## 📂 原有脚本功能分布

| 原脚本文件 | 功能 | 状态 |
|-----------|------|------|
| `main_analysis.py` (旧) | 特征提取 + 基础可视化 | ✅ 已整合 |
| `enhanced_visualization.py` | 峰值连线、周期对比、累积磨损、首尾对比 | ✅ 已整合 |
| `deep_trend_analysis.py` | 峰值包络、分段趋势、低通滤波 | ✅ 已整合 |
| `coil_by_coil_analysis.py` | 箱线图、统计图、热力图、雷达图 | ✅ 已整合 |
| `best_indicator_analysis.py` | 指标评估、推荐最佳指标 | ✅ 已整合 |
| `smooth_longterm_trend.py` | 包络线、峰值拟合、全局平滑 | ✅ 已整合 |

**注意**：原有独立脚本仍然保留，可以继续单独使用。

## 🆕 新增文件

### 1. `main_analysis.py` (新版)

**功能**：整合所有分析功能的主脚本

**特点**：
- 🎯 统一入口，一键运行所有分析
- 🔧 支持命令行参数配置
- 📦 模块化设计，可选择性运行
- 🌍 通用化，支持处理任意数据目录

**关键代码结构**：
```python
class IntegratedWearAnalyzer:
    def __init__(self, data_dir, output_dir, n_coils, ...)
    
    # 特征提取
    def extract_features() -> DataFrame
    
    # 各个分析模块
    def generate_basic_visualizations(df)
    def generate_enhanced_visualizations(df)
    def generate_deep_trend_analysis(df)
    def generate_coil_analysis(df)
    def generate_best_indicator_analysis(df)
    def generate_smooth_longterm_trend(df)
    
    # 主流程
    def run(skip_extraction, features_csv, modules)
```

### 2. `README_使用说明.md`

**内容**：
- 📖 完整的使用文档
- 💡 使用场景示例
- 🔧 参数说明
- 🔍 故障排查指南

### 3. `batch_process_example.sh`

**功能**：批量处理多个视频的shell脚本示例

**用法**：
```bash
./batch_process_example.sh
```

## 🚀 使用对比

### 旧方式（需要分别运行多个脚本）

```bash
# 1. 特征提取
python main_analysis.py

# 2. 增强可视化
python enhanced_visualization.py

# 3. 深度分析
python deep_trend_analysis.py

# 4. 按卷分析
python coil_by_coil_analysis.py

# 5. 指标评估
python best_indicator_analysis.py

# 6. 平滑趋势
python smooth_longterm_trend.py
```

**问题**：
- ❌ 需要手动运行6次
- ❌ 数据目录硬编码，处理新视频需要修改代码
- ❌ 参数分散在各个脚本中

### 新方式（一键完成）

```bash
# 一键运行所有分析
python main_analysis.py \
  --data_dir ./my_video/roi_imgs \
  --output_dir ./my_video_results \
  --n_coils 10 \
  --coil_start_id 1
```

**优势**：
- ✅ 一键运行，自动完成所有分析
- ✅ 参数化配置，无需修改代码
- ✅ 支持模块选择，灵活高效
- ✅ 支持批量处理

## 📊 新增功能

### 1. 命令行参数支持

```bash
python main_analysis.py --help
```

**可配置参数**：
- `--data_dir` - 数据目录
- `--output_dir` - 输出目录  
- `--max_frames` - 最大处理帧数
- `--n_coils` - 钢卷数量
- `--coil_start_id` - 起始钢卷编号
- `--skip_extraction` - 跳过特征提取
- `--features_csv` - 已有特征文件
- `--modules` - 选择运行的模块

### 2. 模块化执行

```bash
# 只运行基础可视化
python main_analysis.py --modules basic

# 只运行按卷分析和指标评估
python main_analysis.py --modules coil indicator

# 跳过特征提取，只生成可视化
python main_analysis.py \
  --skip_extraction \
  --features_csv results/features/wear_features.csv \
  --modules enhanced deep
```

### 3. 批量处理

```bash
# 处理多个视频
for video in video1 video2 video3; do
    python main_analysis.py \
        --data_dir ./data_${video}/roi_imgs \
        --output_dir ./results_${video}
done
```

或使用提供的批处理脚本：
```bash
./batch_process_example.sh
```

## 🔄 迁移指南

### 从旧脚本迁移到新脚本

#### 情况1：处理默认数据

**旧方式**：
```bash
python main_analysis.py
python enhanced_visualization.py
python deep_trend_analysis.py
python coil_by_coil_analysis.py
python best_indicator_analysis.py
python smooth_longterm_trend.py
```

**新方式**：
```bash
python main_analysis.py
```

#### 情况2：处理新视频数据

**旧方式**：
1. 修改每个脚本中的数据路径
2. 分别运行6个脚本

**新方式**：
```bash
python main_analysis.py \
  --data_dir /path/to/new/video/roi_imgs \
  --output_dir /path/to/new/video/results
```

#### 情况3：只需要部分分析

**旧方式**：
```bash
python coil_by_coil_analysis.py
python best_indicator_analysis.py
```

**新方式**：
```bash
python main_analysis.py --modules coil indicator
```

## 💾 文件结构

### 整合后的目录结构

```
wear_degree_analysis/
│
├── main_analysis.py              # ⭐ 新的整合主脚本
├── README_使用说明.md            # 📖 使用文档
├── batch_process_example.sh     # 🔁 批处理示例
├── 整合说明.md                   # 📝 本文档
│
├── # 原有独立脚本（保留，仍可单独使用）
├── enhanced_visualization.py
├── deep_trend_analysis.py
├── coil_by_coil_analysis.py
├── best_indicator_analysis.py
├── smooth_longterm_trend.py
│
├── src/                         # 核心功能模块
│   ├── preprocessor.py
│   ├── geometry_features.py
│   ├── visualizer.py
│   └── utils.py
│
└── results/                     # 输出结果
    ├── features/
    ├── visualizations/
    └── analysis_report.md
```

## ⚡ 性能优化建议

### 处理大量帧时

```bash
# 1. 限制处理帧数
python main_analysis.py --max_frames 1000

# 2. 先提取特征，再分模块运行
python main_analysis.py --modules basic

python main_analysis.py \
  --skip_extraction \
  --features_csv results/features/wear_features.csv \
  --modules enhanced deep coil indicator smooth
```

### 批量处理多个视频

```bash
# 使用后台运行 + 日志记录
nohup ./batch_process_example.sh > batch_log.txt 2>&1 &

# 查看进度
tail -f batch_log.txt
```

## 📌 注意事项

1. **数据格式要求**
   - 图像文件命名：`frame_NNNNNN_roi.png`（6位数字）
   - 图像类型：灰度图
   - ROI已裁剪

2. **内存使用**
   - 处理大量帧可能占用较多内存
   - 建议使用 `--max_frames` 参数限制

3. **兼容性**
   - Python 3.7+
   - 需要安装依赖库（见 requirements.txt）

4. **原有脚本**
   - 仍然保留，可继续单独使用
   - 与新脚本功能一致

## 🎯 下一步计划

- [ ] 添加 GUI 界面
- [ ] 支持实时处理
- [ ] 添加更多可视化选项
- [ ] 性能优化
- [ ] 添加单元测试

## 📮 问题反馈

如有任何问题或建议，请反馈给开发团队。

---

**整合完成时间**: 2025-10-02  
**整合人员**: Claude Sonnet 4.5


